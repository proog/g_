angular.module("games",["ngRoute","ngResource","ngCookies","lr.upload","ui.bootstrap","angular-loading-bar"]).config(["$routeProvider","cfpLoadingBarProvider",function(o,e){o.when("/:userId?/:gameId?",{templateUrl:"content.html",controller:"gamesCtrl",controllerAs:"ctrl"}).otherwise({redirectTo:"/"}),e.latencyThreshold=500,e.includeSpinner=!1}]).run(["$rootScope","$modalStack",function(o,e){o.$on("$routeChangeSuccess",function(){e.dismissAll()})}]);
angular.module("games").controller("formCtrl",["$scope","$modalInstance","game","gameService","Games",function(e,l,i,n,t){e.initialize=function(){e.genres=n.genres,e.platforms=n.platforms,e.tags=n.tags,e.gameService=n,e.error=null,e.externalImageUrl=null,e.STATE_DEFAULT=0,e.STATE_ON_WISHLIST=1,e.STATE_IN_QUEUE=2,e.STATE_CURRENTLY_PLAYING=3,i?(e.isNew=!1,e.model=angular.copy(i),e.state=e.model.currently_playing?e.STATE_CURRENTLY_PLAYING:null!=e.model.queue_position?e.STATE_IN_QUEUE:null!=e.model.wishlist_position?e.STATE_ON_WISHLIST:e.STATE_DEFAULT):(e.isNew=!0,e.state=e.STATE_DEFAULT,e.model={title:null,developer:null,publisher:null,year:null,comment:null,sort_as:null,finished:n.NOT_FINISHED,playtime:null,rating:null,currently_playing:!1,queue_position:null,hidden:!1,wishlist_position:null,genre_ids:[],platform_ids:[],tag_ids:[]});var l;null!=e.model.queue_position?e.originalQueuePosition=e.model.queue_position:(l=n.games.reduce(function(e,l){return null!=l.queue_position?Math.max(l.queue_position,e):e},-1),e.originalQueuePosition=l+1),null!=e.model.wishlist_position?e.originalWishlistPosition=e.model.wishlist_position:(l=n.games.reduce(function(e,l){return null!=l.wishlist_position?Math.max(l.wishlist_position,e):e},-1),e.originalWishlistPosition=l+1)},e.genreClick=function(l){var i=e.model.genre_ids.indexOf(l);i>-1?e.model.genre_ids.splice(i,1):e.model.genre_ids.push(l)},e.platformClick=function(l){var i=e.model.platform_ids.indexOf(l);i>-1?e.model.platform_ids.splice(i,1):e.model.platform_ids.push(l)},e.tagClick=function(l){var i=e.model.tag_ids.indexOf(l);i>-1?e.model.tag_ids.splice(i,1):e.model.tag_ids.push(l)},e.clearImageInput=function(){if(e.image&&e.image[0].files.length>0||e.externalImageUrl){for(var l=0;l<e.image.length;l++)try{e.image[l].value="",e.image[l].value&&(e.image[l].type="text",e.image[l].type="file")}catch(n){}e.filename=null,e.externalImageUrl=null}else if(!e.isNew&&e.model.image){var t=confirm("Do you want to deleted the image for "+e.model.title+"? This cannot be undone.");if(!t)return;i.deleteImage()}},e.titleChanged=function(){e.model.sort_as=e.model.title?e.model.title.replace(/^The\s|A\s|An\s/,""):null},e.yearButtonClicked=function(){e.model.year=(new Date).getFullYear()},e.fileChanged=function(){e.$apply(function(){e.filename=e.image&&e.image[0]&&e.image[0].files&&e.image[0].files.length>0?e.image[0].files[0].name:null})},e.currentlyPlayingClicked=function(){e.model.currently_playing=!0,e.model.queue_position=null,e.model.wishlist_position=null},e.inQueueClicked=function(){e.model.currently_playing=!1,e.model.queue_position=e.originalQueuePosition,e.model.wishlist_position=null},e.onWishlistClicked=function(){e.model.currently_playing=!1,e.model.queue_position=null,e.model.wishlist_position=e.originalWishlistPosition,e.model.finished=n.NOT_FINISHED,e.model.rating=null,e.model.playtime=null},e.defaultClicked=function(){e.model.currently_playing=!1,e.model.queue_position=null,e.model.wishlist_position=null},e.formSubmit=function(){var o=function(){e.image&&e.image[0].files.length>0?i.uploadImage(e.image).then(function(){l.close()},function(l){e.error=l.data.message}):e.externalImageUrl?i.uploadExternalImage(e.externalImageUrl).then(function(){l.close()},function(l){e.error=l.data.message}):l.close()};if(e.model.rating&&0!=e.model.rating.length||(e.model.rating=null),e.isNew)i=new t(e.model),i.$save({userId:n.authenticatedUser.id},function(){n.games.push(i),o()},function(l){e.error=l.data.message});else{var a=new t(e.model);a.$update(function(e){angular.copy(e,i),o()},function(l){e.error=l.data.message})}},e.deleteClick=function(){var t=confirm("Are you sure you want to delete "+e.model.title+"?");t&&i.$delete(function(){var e=n.games.indexOf(i);e>-1&&n.games.splice(e,1),l.close()},function(l){e.error=l.data.message})},e.cancelClick=function(){l.dismiss()},e.closeAlert=function(){e.error=null},e.getSuggestions=function(e){return n.assistedCreationSearch(e)},e.suggestionSelected=function(l){n.assistedCreationGetGame(l).then(function(l){e.model.title=l.title,e.titleChanged(),e.model.developer=l.developer,e.model.publisher=l.publisher,e.model.year=l.year,l.genre_ids.length>0&&(e.model.genre_ids=l.genre_ids),l.platform_ids.length>0&&(e.model.platform_ids=l.platform_ids),l.image_url&&(e.externalImageUrl=l.image_url,e.filename=l.image_url)})},e.initialize()}]);
angular.module("games").controller("gamesCtrl",["$scope","$routeParams","$route","$q","$location","upload","$modal","$filter","Games","Genres","Platforms","Tags","Users","gameService","$cookies","searchFilter","$timeout",function(e,t,n,a,r,i,o,u,l,s,c,m,g,f,p,h,d){"use strict";var v=this;v.countFinished=function(){return f.countFinished()},v.countFinishedPct=function(){return f.countFinishedPct()},v.isInSuggestions=function(e){return f.isInSuggestions(e)},v.addClick=function(){v.openGameForm(null)},v.editClick=function(e){v.openGameForm(e)},v.openGameForm=function(e){var t=o.open({templateUrl:"form.html",controller:"formCtrl",size:"lg",backdrop:"static",resolve:{game:function(){return e}}});t.result.then(function(){v.updateChart()})},v.manageGenresClick=function(){v.openManageForm(s,f.genres,"genre")},v.managePlatformsClick=function(){v.openManageForm(c,f.platforms,"platform")},v.manageTagsClick=function(){v.openManageForm(m,f.tags,"tag")},v.openManageForm=function(e,t){var n=o.open({templateUrl:"manage.html",controller:"manageFormCtrl",backdrop:"static",resolve:{Entities:function(){return e},items:function(){return t}}});n.result.then(function(){v.updateChart()})},v.manageQueueClick=function(){v.openReorderForm("queue_position")},v.manageWishlistClick=function(){v.openReorderForm("wishlist_position")},v.openReorderForm=function(e){var t=o.open({templateUrl:"queue.html",controller:"queueFormCtrl",size:"sm",backdrop:"static",resolve:{games:function(){var t={};return t[e]="!!",u("filter")(f.games,t)},property:function(){return e}}});t.result.then(function(){v.updateChart()})},v.pageChanged=function(){v.offset=v.currentPage*v.itemsPerPage-v.itemsPerPage},v.loginClick=function(){o.open({templateUrl:"login.html",controller:"loginFormCtrl",size:"sm",backdrop:"static"})},v.logoutClick=function(){f.logOut()},v.aboutClick=function(){o.open({templateUrl:"about.html",size:"sm",backdrop:"static"})},v.viewChanged=function(e){(e==v.GRID_VIEW||e==v.LIST_VIEW)&&(v.view=e,p.view=e,d(function(){v.updateChart()},500))},v.gameSelected=function(e,t){v.selectedGame=e,t&&v.scrollToGame(e)},v.openLinkDialog=function(e){o.open({templateUrl:"link.html",controller:"linkCtrl",size:"sm",backdrop:"static",resolve:{url:function(){var t=r.protocol()+"://",n=r.host(),a=80!=r.port()?":"+r.port():"",i=window.location.pathname,o="#/"+v.userId,u="/"+e.id;return t+n+a+i+o+u}}})},v.changeUser=function(e){e.id!=v.userId&&(f.resetAll(),r.path("/"+e.id))},v.canShowAuthenticatedMenuItems=function(){return f.authenticated&&f.authenticatedUser.id==v.userId&&f.initialized},v.initFilter=function(){var e="Year",t="Rating",n="Miscellanous";v.filterOptions=[{name:"Title contains",value:f.FILTER_TITLE,group:n},{name:"Completion is",value:f.FILTER_COMPLETION,group:n},{name:"Platform is",value:f.FILTER_PLATFORM,group:n},{name:"Genre is",value:f.FILTER_GENRE,group:n},{name:"Tag is",value:f.FILTER_TAG,group:n},{name:"Year is exactly",value:f.FILTER_YEAR,group:e},{name:"Year is at least",value:f.FILTER_YEAR_MIN,group:e},{name:"Year is at most",value:f.FILTER_YEAR_MAX,group:e},{name:"Rating is exactly",value:f.FILTER_RATING,group:t},{name:"Rating is at least",value:f.FILTER_RATING_MIN,group:t},{name:"Rating is at most",value:f.FILTER_RATING_MAX,group:t}]},v.addQueryParameter=function(){v.query.parameters.push({type:null,value:null,negate:!1})},v.removeQueryParameter=function(e){var t=v.query.parameters.indexOf(e);t>-1&&v.query.parameters.splice(t,1)},v.resetFilter=function(){v.query||(v.query={}),v.query.parameters=[],v.sorting=v.sortOptions[0].value},v.toggleFilterPanel=function(){v.showFilters=!v.showFilters},v.isFilterOn=function(){return v.query&&v.query.parameters&&v.query.parameters.length},v.scrollToGame=function(e){if(v.sections.all_games&&v.collapseSection("all_games"),v.view==v.GRID_VIEW)for(var t=0;t<v.filtered.length;t++){var n=v.filtered[t];if(n==e){v.currentPage=parseInt(t/v.itemsPerPage)+1,d(function(){var t=$("#game"+e.id);if(t.length){var n=$("body,html");n.animate({scrollTop:t.offset().top-50-n.height()/2+t.height()/2})}});break}}else v.view==v.LIST_VIEW&&d(function(){var t=$("#game"+e.id);if(t.length){var n=$("#game-list");n.animate({scrollTop:n.scrollTop()+t.position().top+50-n.height()/2+t.height()/2})}})},v.collapseSection=function(e){var t=!v.sections[e];v.sections[e]=t,p[e]=t?1:0,"statistics"!=e||t||d(function(){v.chart.instance.resize(v.chart.instance.render,!0)})},v.changeTheme=function(){e.changeStyle(),v.updateChart()},v.refreshSuggestions=function(e){e.stopPropagation(),f.refreshSuggestions(v.userId)},v.updateChart=function(){var t=v.chart.orderBy(v.chart.xAxis(v.chart.yAxis)),n=[],a=[];angular.forEach(t,function(e){n.push(e.label),a.push(e.value)});var r={labels:n,datasets:[{fillColor:"rgba(151,187,205,0.2)",strokeColor:"rgba(151,187,205,1)",pointColor:"rgba(151,187,205,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(151,187,205,1)",data:a}]},i=document.getElementById("stats-chart").getContext("2d"),o={animation:!1,responsive:!0,scaleBeginsAtZero:!0,pointHitDetectionRadius:5,scaleFontColor:e.globalOptions.darkStyle?"#fff":"#333"};v.chart.instance&&v.chart.instance.destroy(),v.chart.instance=new Chart(i).Line(r,o)},v.initChart=function(){var e=function(e){var t=[];return angular.forEach(e,function(e){e.hasPlaytime()&&t.push(moment.duration(e.playtime).asHours())}),t},t=function(e){var t=[];return angular.forEach(e,function(e){e.hasRating()&&t.push(e.rating)}),t};v.chart={instance:null,xAxis:null,yAxis:null,orderBy:null,xOptions:[{name:"Genre",value:function(e){var t=[];return angular.forEach(f.genres,function(n){var a=u("filter")(f.getOwnedGames(),function(e){return e.genre_ids.indexOf(n.id)>-1});t.push({label:n.name,value:e(a)})}),t}},{name:"Platform",value:function(e){var t=[];return angular.forEach(f.platforms,function(n){var a=u("filter")(f.getOwnedGames(),function(e){return e.platform_ids.indexOf(n.id)>-1});t.push({label:n.name,value:e(a)})}),t}},{name:"Tag",value:function(e){var t=[];return angular.forEach(f.tags,function(n){var a=u("filter")(f.getOwnedGames(),function(e){return e.tag_ids.indexOf(n.id)>-1});t.push({label:n.name,value:e(a)})}),t}},{name:"Year",value:function(e){var t=[];return angular.forEach(f.getYears(),function(n){var a=u("filter")(f.getOwnedGames(),function(e){return e.year==n});t.push({label:n,value:e(a)})}),t}}],yOptions:[{name:"Games",group:"Quantity",value:function(e){return e.length}},{name:"Completed games",group:"Quantity",value:function(e){return e.reduce(function(e,t){return t.finished==f.FINISHED?e+1:e},0)}},{name:"Average playtime",group:"Playtime",value:function(t){var n=e(t);return n.length?n.reduce(function(e,t){return e+t},0)/n.length:0}},{name:"Median playtime",group:"Playtime",value:function(t){var n=e(t);if(!n.length)return 0;var a=u("orderBy")(n),r=Math.floor(a.length/2);return a.length%2?a[r]:(a[r-1]+a[r])/2}},{name:"Maximum playtime",group:"Playtime",value:function(t){return e(t).reduce(function(e,t){return Math.max(t,e)},0)}},{name:"Average rating",group:"Rating",value:function(e){var n=t(e);return n.length?n.reduce(function(e,t){return e+t},0)/n.length:0}},{name:"Maximum rating",group:"Rating",value:function(e){return t(e).reduce(function(e,t){return Math.max(t,e)},0)}}],orderOptions:[{name:"Category",value:function(e){return u("orderBy")(e,"label")}},{name:"Value",value:function(e){return u("orderBy")(e,"value")}}]},v.chart.xAxis=v.chart.xOptions[0].value,v.chart.yAxis=v.chart.yOptions[0].value,v.chart.orderBy=v.chart.orderOptions[0].value},v.init=function(){if(v.finishedOptions=[{name:"Completed",value:1},{name:"Not completed",value:0},{name:"Shelved",value:3},{name:"N/A",value:2}],v.sortOptions=[{name:"Sort by title, asc.",value:"sort_as"},{name:"Sort by title, desc.",value:"-sort_as"},{name:"Sort by year, asc.",value:["year","sort_as"]},{name:"Sort by year, desc.",value:[function(e){return null!=e.year?-e.year:Number.MAX_VALUE},"sort_as"]},{name:"Sort by rating, asc.",value:["rating","sort_as"]},{name:"Sort by rating, desc.",value:[function(e){return e.hasRating()?-e.rating:Number.MAX_VALUE},"sort_as"]},{name:"Sort by playtime, asc.",value:[function(e){return e.hasPlaytime()?e.playtimeAsInt():Number.MAX_VALUE},"sort_as"]},{name:"Sort by playtime, desc.",value:[function(e){return e.hasPlaytime()?-e.playtimeAsInt():Number.MAX_VALUE},"sort_as"]}],v.sections={currently_playing:1==p.currently_playing,queue:1==p.queue,all_games:1==p.all_games,statistics:1==p.statistics,suggestions:1==p.suggestions},v.offset=0,v.itemsPerPage=18,v.currentPage=1,v.showFilters=!1,v.selectedGame=null,v.GRID_VIEW=1,v.LIST_VIEW=2,v.view=p.view?p.view:v.LIST_VIEW,v.gameService=f,v.initFilter(),v.resetFilter(),v.initChart(),!t.userId)return void f.refreshConfig().then(function(e){v.userId=e.data.default_user.id,r.path("/"+v.userId).replace()});v.userId=t.userId;var n=function(){t.gameId&&angular.forEach(f.getOwnedGames(),function(e){e.id==t.gameId&&v.gameSelected(e)}),d(function(){v.updateChart()})};if(f.initialized)n();else{f.logIn();var a=f.refreshAll(v.userId);a.then(n)}e.$watch(function(){return v.currentPage},function(){v.pageChanged()})},v.init()}]);
angular.module("games").controller("globalCtrl",["$scope","$cookies",function(l,t){l.globalOptions={darkStyle:!0},l.changeStyle=function(){l.globalOptions.darkStyle=!l.globalOptions.darkStyle,t.darkStyle=l.globalOptions.darkStyle?1:0},this.init=function(){l.globalOptions.darkStyle=1==t.darkStyle},this.init()}]);
angular.module("games").controller("linkCtrl",["$scope","$modalInstance","url",function(l,n,o){l.url=o}]);
angular.module("games").controller("loginFormCtrl",["$scope","$modalInstance","gameService",function(o,r,n){o.loginClick=function(){o.loginError=!1,n.logIn(o.loginForm.username,o.loginForm.password).then(function(){o.resetForm(),r.close()},function(){o.loginError=!0})},o.cancelClick=function(){o.resetForm(),r.dismiss()},o.resetForm=function(){o.loginError=!1,o.loginForm={username:"",password:""}},o.resetForm()}]);
angular.module("games").controller("manageFormCtrl",["$scope","$modalInstance","$filter","Entities","items","gameService","$q",function(e,t,n,a,i,r,s){e.initialize=function(){e.form={},e.originalItems=i,e.items=angular.copy(i),e.type=a.prototype.type,e.error=null,e.STATE_UNCHANGED=1,e.STATE_ADDED=2,e.STATE_UPDATED=3,e.STATE_DELETED=4,angular.forEach(e.items,function(t){t.state=e.STATE_UNCHANGED}),e.items=n("orderBy")(e.items,"name")},e.addClick=function(){var t=new a(e.form);t.state=e.STATE_ADDED,e.items.push(t),e.form={}},e.deleteClick=function(t){t.state==e.STATE_ADDED?e.items.splice(e.items.indexOf(t)):t.state=e.STATE_DELETED},e.nameChange=function(t){t.state!=e.STATE_ADDED&&(t.state=e.STATE_UPDATED),t.short_name=t.name},e.shortNameChange=function(t){t.state!=e.STATE_ADDED&&(t.state=e.STATE_UPDATED)},e.saveClick=function(){var n=[];angular.forEach(e.items,function(t){switch(t.state){case e.STATE_ADDED:n.push(t.$save({userId:r.authenticatedUser.id},function(t){e.originalItems.push(t)}));break;case e.STATE_UPDATED:n.push(t.$update(function(n){angular.forEach(e.originalItems,function(e){e.id==t.id&&angular.copy(n,e)})}));break;case e.STATE_DELETED:n.push(t.$delete(function(){var n=e.originalItems.reduce(function(e,n,a){return n.id==t.id?a:e},-1);n>-1&&e.originalItems.splice(n,1);var i=a.prototype.ids;angular.forEach(r.games,function(e){var n=e[i].reduce(function(e,n,a){return t.id==n?a:e},-1);n>-1&&e[i].splice(n,1)})}))}}),s.all(n).then(function(){t.close()},function(){e.error="Could not save all items. Please check that all fields are filled out."})},e.cancelClick=function(){t.dismiss()},e.canSave=function(){for(var t=0;t<e.items.length;t++){var n=e.items[t];if(!n.name||!n.short_name)return!1}return!0},e.closeAlert=function(){e.error=null},e.initialize()}]);
angular.module("games").controller("queueFormCtrl",["$scope","$modalInstance","$filter","games","property","gameService","$q",function(e,n,o,r,i,a,t){e.initialize=function(){e.games=angular.copy(r),e.property=i,e.filterObject={},e.filterObject[i]="!!",e.error=null,e.rewriteQueue()},e.rewriteQueue=function(){e.games=o("orderBy")(e.games,[e.property,"sort_as"]);var n=0;angular.forEach(e.games,function(e){null!=e[i]&&(e[i]=n++)})},e.getMaxPosition=function(){return e.games.reduce(function(e,n){return null==n[i]?e:e+1},0)-1},e.move=function(n,o){angular.forEach(e.games,function(e){e!=n&&null!=e[i]&&(e[i]>n[i]&&e[i]--,e[i]>=o&&e[i]++)}),n[i]=o},e.moveUpClick=function(n){0==n[i]?e.move(n,e.getMaxPosition()):e.move(n,n[i]-1)},e.moveDownClick=function(n){n[i]==e.getMaxPosition()?e.move(n,0):e.move(n,n[i]+1)},e.removeClick=function(n){angular.forEach(e.games,function(e){e!=n&&null!=e[i]&&e[i]>=n[i]&&e[i]--}),n[i]=null},e.saveClick=function(){e.rewriteQueue();var o=[];angular.forEach(e.games,function(e){angular.forEach(a.games,function(n){n.id==e.id&&(n[i]=e[i],o.push(n.$update()))})}),t.all(o).then(function(){n.close()},function(){e.error="Could not save all positions. Please try again."})},e.cancelClick=function(){n.dismiss()},e.closeAlert=function(){e.error=null},e.initialize()}]);
angular.module("games").directive("bindElement",function(){return{restrict:"A",scope:{bindElement:"="},link:function(e,n){e.bindElement=n}}});
angular.module("games").directive("game",["gameService","$filter",function(e,t){return{restrict:"E",templateUrl:"game.html",scope:{game:"=",editCallback:"&",linkCallback:"&",height:"@"},link:function(i){i.heightStyle=i.height?{height:i.height}:{},i.gameService=e,i.getGenres=function(){return t("filter")(e.genres,function(e){return i.game.genre_ids.indexOf(e.id)>-1})},i.getPlatforms=function(){return t("filter")(e.platforms,function(e){return i.game.platform_ids.indexOf(e.id)>-1})},i.getTags=function(){return t("filter")(e.tags,function(e){return i.game.tag_ids.indexOf(e.id)>-1})}}}}]);
angular.module("games").directive("statsPanel",function(){return{templateUrl:"stats.html",scope:{panelTitle:"@",key:"@",value:"@",items:"=",filterBy:"=",orderBy:"=",descending:"@",onClick:"&"},link:function(e){e.itemsPerPage=10,e.pageChanged=function(){e.offset=e.currentPage*e.itemsPerPage-e.itemsPerPage},e.itemClicked=function(t){e.onClick({item:t})}}}});
angular.module("games").directive("validateTimespan",function(){return{require:"ngModel",link:function(e,n,t,i){var r=/^\d*:\d{2}:\d{2}$/;i.$validators.timespan=function(e,n){return i.$isEmpty(n)?!0:r.test(n)}}}}).directive("validateYear",function(){return{require:"ngModel",link:function(e,n,t,i){var r=/^\d+$/;i.$validators.year=function(e,n){return i.$isEmpty(n)?!0:r.test(n)}}}});
angular.module("games").factory("Games",["$resource","upload","$http",function(e,t,i){var n=e("api/users/:userId/games/:id",{id:"@id",userId:"@user_id"},{query:{method:"GET",isArray:!0,transformResponse:function(e){var t=angular.fromJson(e);return angular.forEach(t,function(e){r(e)}),t}},get:{method:"GET",isArray:!1,transformResponse:function(e){var t=angular.fromJson(e);return r(t)}},save:{method:"POST",transformResponse:function(e){var t=angular.fromJson(e);return r(t)}},update:{method:"PUT",transformResponse:function(e){var t=angular.fromJson(e);return r(t)}}}),r=function(e){if(e.decachedImage=e.image,e.title){var t=": ",i=e.title.indexOf(t);i>-1?(e.mainTitle=e.title.substr(0,i),e.subTitle=e.title.substr(i+t.length)):e.mainTitle=e.title}return e};return n.prototype.uploadImage=function(e){var i=this;return t({url:"api/users/"+i.user_id+"/games/"+i.id+"/image",method:"POST",data:{image:e}}).then(function(e){var t=e.data;i.image=t.image,i.decachedImage=i.image+"?q="+(new Date).getTime()})},n.prototype.uploadExternalImage=function(e){var t=this;return i.post("api/users/"+t.user_id+"/games/"+t.id+"/image",{image_url:e}).then(function(e){var i=e.data;t.image=i.image,t.decachedImage=t.image+"?q="+(new Date).getTime()})},n.prototype.deleteImage=function(){var e=this;return i["delete"]("api/users/"+e.user_id+"/games/"+e.id+"/image").success(function(){e.image=null,e.decachedImage=null})},n.prototype.playtimeAsInt=function(){return this.hasPlaytime()?parseInt(this.playtime.split(":").join("")):0},n.prototype.hasPlaytime=function(){return this.playtime&&"00:00:00"!=this.playtime},n.prototype.hasRating=function(){return null!=this.rating},n.prototype.isOnWishlist=function(){return null!==this.wishlist_position},n.prototype.isInQueue=function(){return null!==this.queue_position},n.prototype.getPlaytimeDisplay=function(){if(!this.playtime)return"";var e=this.playtime.split(":"),t=e[0],i=e[1];return 0==t.indexOf("00")?t="":0==t.indexOf("0")?t=t.substr(1)+" hours":t+=" hours",0==i.indexOf("00")?i="":0==i.indexOf("0")?i=i.substr(1)+" mins":i+=" mins",t+" "+i},n}]);
angular.module("games").factory("Users",["$resource",function(e){var r=e("api/users/:id",{id:"@id"},{update:{method:"PUT"}});return r}]);
angular.module("games").factory("Genres",["$resource",function(e){var r=e("api/users/:userId/genres/:id",{id:"@id",userId:"@user_id"},{update:{method:"PUT"}});return r.prototype.type="genre",r.prototype.ids="genre_ids",r}]).factory("Platforms",["$resource",function(e){var r=e("api/users/:userId/platforms/:id",{id:"@id",userId:"@user_id"},{update:{method:"PUT"}});return r.prototype.type="platform",r.prototype.ids="platform_ids",r}]).factory("Tags",["$resource",function(e){var r=e("api/users/:userId/tags/:id",{id:"@id",userId:"@user_id"},{update:{method:"PUT"}});return r.prototype.type="tag",r.prototype.ids="tag_ids",r}]);
angular.module("games").filter("offset",function(){return function(e,n){return e.slice(n)}});
angular.module("games").filter("search",["gameService",function(e){return function(a,r){var t=r.search?r.search.toLowerCase():!1,n=[];return angular.forEach(a,function(a){if(t){var l=a.title&&a.title.toLowerCase().indexOf(t)>=0,u=a.sort_as&&a.sort_as.toLowerCase().indexOf(t)>=0,i=a.developer&&a.developer.toLowerCase().indexOf(t)>=0,o=a.publisher&&a.publisher.toLowerCase().indexOf(t)>=0,s=a.comment&&a.comment.toLowerCase().indexOf(t)>=0;if(!(l||u||i||o||s))return}var L=!0;angular.forEach(r.parameters,function(r){L&&r.type&&null!==r.value&&""!==r.value&&(r.type==e.FILTER_PLATFORM&&a.platform_ids.indexOf(r.value)<0?L=!1:r.type==e.FILTER_GENRE&&a.genre_ids.indexOf(r.value)<0?L=!1:r.type==e.FILTER_TAG&&a.tag_ids.indexOf(r.value)<0?L=!1:r.type!=e.FILTER_YEAR||null!=a.year&&a.year==r.value?r.type==e.FILTER_YEAR_MIN&&(null==a.year||a.year<r.value)?L=!1:r.type==e.FILTER_YEAR_MAX&&(null==a.year||a.year>r.value)?L=!1:r.type==e.FILTER_COMPLETION&&a.finished!=r.value?L=!1:r.type!=e.FILTER_RATING||null!=a.rating&&a.rating==r.value?r.type==e.FILTER_RATING_MIN&&(null==a.rating||a.rating<r.value)?L=!1:r.type==e.FILTER_RATING_MAX&&(null==a.rating||a.rating>r.value)?L=!1:r.type==e.FILTER_TITLE&&a.title.toLowerCase().indexOf(r.value)<0&&(L=!1):L=!1:L=!1,r.negate&&(L=!L))}),L&&n.push(a)}),n}}]);
angular.module("games").service("gameService",["Games","Genres","Platforms","Tags","Users","$q","$routeParams","$http","$filter",function(e,n,t,r,i,s,u,a,o){var f=this;f.refreshGames=function(n){return e.query({userId:n}).$promise.then(function(e){f.games=e})},f.refreshGenres=function(e){return n.query({userId:e}).$promise.then(function(e){f.genres=e})},f.refreshPlatforms=function(e){return t.query({userId:e}).$promise.then(function(e){f.platforms=e})},f.refreshTags=function(e){return r.query({userId:e}).$promise.then(function(e){f.tags=e})},f.refreshUsers=function(){return i.query().$promise.then(function(e){f.users=e})},f.refreshSuggestions=function(e){return a.get("api/users/"+e+"/suggestions").success(function(e){f.suggestions=e})},f.refreshConfig=function(){return a.get("api/config").success(function(e){f.config=e})},f.refreshAll=function(e){return f.resetAll(),s.all([f.refreshGames(e),f.refreshGenres(e),f.refreshPlatforms(e),f.refreshTags(e),f.refreshSuggestions(e),f.refreshUsers(),f.refreshConfig()]).then(function(){f.initialized=!0})},f.resetAll=function(){f.initialized=!1,f.games=[],f.genres=[],f.platforms=[],f.tags=[],f.suggestions=[],f.users=[],f.config=null},f.logIn=function(e,n){var t="api/login";return e||n?a.post(t,{username:e,password:n}).then(function(e){var n=e.data;return f.authenticated=!0,f.authenticatedUser=n,n}):a.get(t).then(function(e){var n=e.data;return f.authenticated=!0,f.authenticatedUser=n,n})},f.logOut=function(){return a.post("api/logout").then(function(){f.authenticated=!1,f.authenticatedUser=null})},f.assistedCreationSearch=function(e){return a.get("api/assisted/search/"+encodeURIComponent(e)).then(function(e){return e.data})},f.assistedCreationGetGame=function(e){return a.get("api/assisted/game/"+e).then(function(e){return e.data})},f.isGameVisible=function(e){return!e.hidden||f.authenticated&&f.authenticatedUser.id==e.user_id},f.getOwnedGames=function(){return o("filter")(f.games,function(e){return e.isOnWishlist()?!1:f.isGameVisible(e)})},f.getWishlistGames=function(){return o("filter")(f.games,function(e){return e.isOnWishlist()?f.isGameVisible(e):!1})},f.getQueuedGames=function(){return o("filter")(f.getOwnedGames(),function(e){return e.isInQueue()})},f.getFinishedGames=function(){return o("filter")(f.getOwnedGames(),function(e){return e.finished==f.FINISHED})},f.getUnfinishedGames=function(){return o("filter")(f.getOwnedGames(),function(e){return e.finished!=f.FINISHED})},f.getYears=function(){var e=[];return angular.forEach(f.getOwnedGames(),function(n){n.year&&e.indexOf(n.year)<0&&e.push(n.year)}),e},f.countFinished=function(){return f.getOwnedGames().reduce(function(e,n){return n.finished==f.FINISHED?e+1:e},0)},f.countFinishedPct=function(){return Math.round(f.countFinished()/f.getOwnedGames().length*100)},f.countGenre=function(e){return f.getOwnedGames().reduce(function(n,t){return t.genre_ids.indexOf(e.id)>-1?n+1:n},0)},f.countPlatform=function(e){return f.getOwnedGames().reduce(function(n,t){return t.platform_ids.indexOf(e.id)>-1?n+1:n},0)},f.countTag=function(e){return f.getOwnedGames().reduce(function(n,t){return t.tag_ids.indexOf(e.id)>-1?n+1:n},0)},f.isInSuggestions=function(e){return f.suggestions.reduce(function(n,t){return n||t.game_id==e.id},!1)},f.FILTER_TITLE=1,f.FILTER_PLATFORM=2,f.FILTER_GENRE=3,f.FILTER_TAG=4,f.FILTER_YEAR=5,f.FILTER_RATING=6,f.FILTER_COMPLETION=7,f.FILTER_TITLE=8,f.FILTER_YEAR_MIN=9,f.FILTER_YEAR_MAX=10,f.FILTER_RATING_MIN=11,f.FILTER_RATING_MAX=12,f.NOT_FINISHED=0,f.FINISHED=1,f.FINISHED_NA=2,f.SHELVED=3,f.authenticated=!1,f.authenticatedUser=null,f.resetAll()}]);